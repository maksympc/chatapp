<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Authentication</title>
</head>

<body>
<div>
    <button id="test">Test Loggedin</button>
    <button id="goodLogin">Good Login</button>
    <button id="badLogin">Bad Login</button>
    <button id="logout">Logout</button>
    <br/>
    <button id="ban user">ban</button>
    <button id="unban user">unban</button>
    <button id="mute user">mute</button>
    <button id="unmute user">unmute</button>
    <button id="new message">new message</button>
    <button id="get all users">get all users</button>
    <button id="remove messages">remove messages</button>
</div>
<div><textarea id="token"></textarea></div>

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#test').click(function () {


            let socket = io.connect('http://localhost:3000');
            socket.on('connect', function () {
                socket.emit('authenticate', {token: localStorage.token})
                    .on('authenticated', function () {


                        

                    })
                    .on('unauthorized', function (message) {
                        console.log("unauthorized: " + JSON.stringify(message));
                        alert('Your token has been expired! Please login again!');
                        window.location.replace("https://www.google.com/");
                    })
            });
        });
        $('#goodLogin').click(function () {
            $.ajax({
                type: "POST",
                url: "/api/login",
                data: {
                    email: "admin@admin.com",
                    username: "admin",
                    password: "adminadmin"
                },
                success: function (data) {
                    localStorage.token = data.token;
                    document.getElementById("token").innerText = localStorage.token;
                },
                error: function () {
                    alert("Login Failed");
                }
            });
        });
        $('#badLogin').click(function () {
            $.ajax({
                type: "POST",
                url: "/api/login",
                data: {
                    email: "admin@admin.com",
                    username: "john.doe",
                    password: "foobarfoobar"
                },
                success: function (data) {
                    alert("ERROR: it is not supposed to alert.");
                },
                error: function () {
                    document.getElementById("token").innerText = '';
                    alert("Login Failed");
                }
            });
        });
        $('#logout').click(function () {
            localStorage.clear();
            document.getElementById("token").innerText = '';
        });
    });
</script>
</body>

</html>
<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Authentication</title>
</head>

<body>
<div>
    <button id="test">Test Loggedin</button>
    <button id="goodLogin">Good Login</button>
    <button id="badLogin">Bad Login</button>
    <button id="logout">Logout</button>
</div>
<div><textarea id="token"></textarea></div>
<div><textarea id="users"></textarea></div>

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#test').click(function () {
            if (localStorage.token) {
                document.getElementById("token").innerText = localStorage.token;
                alert('Hello! Your token is:' + localStorage.token);

                let socket = io({'query': 'token=' + localStorage.token});

                socket.on('test', function (data) {
                    console.log(JSON.stringify(data));
                    document.getElementById("users").innerText = JSON.stringify(data);
                });
            }
            else {
                document.getElementById("token").innerText = '';
                alert('Hello! Empty localStorage!');
            }
        });
        $('#goodLogin').click(function () {
            $.ajax({
                type: "POST",
                url: "/api/login",
                data: {
                    email: "admin@admin.com",
                    username: "admin",
                    password: "adminadmin"
                },
                success: function (data) {
                    localStorage.token = data.token;
                    document.getElementById("token").innerText = localStorage.token;
                },
                error: function () {
                    alert("Login Failed");
                }
            });
        });
        $('#badLogin').click(function () {
            $.ajax({
                type: "POST",
                url: "/api/login",
                data: {
                    email: "admin@admin.com",
                    username: "john.doe",
                    password: "foobarfoobar"
                },
                success: function (data) {
                    alert("ERROR: it is not supposed to alert.");
                },
                error: function () {
                    document.getElementById("token").innerText = '';
                    alert("Login Failed");
                }
            });
        });
        $('#logout').click(function () {
            localStorage.clear();
            document.getElementById("token").innerText = '';
        });
    });
</script>
</body>

</html>